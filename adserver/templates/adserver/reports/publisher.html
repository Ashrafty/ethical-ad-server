{% extends "adserver/reports/base.html" %}
{% load humanize %}
{% load i18n %}


{% block title %}{% trans 'Revenue Report' %} - {{ publisher }}{% endblock %}


{% block heading %}{% blocktrans %}Revenue Report for {{ publisher }}{% endblocktrans %}{% endblock heading %}


{% block breadcrumbs %}
  {{ block.super }}
  <li class="breadcrumb-item active">{{ publisher }}</li>
{% endblock breadcrumbs %}

{% block additional_filters %}
{% endblock additional_filters %}


{% block explainer %}
<section class="mb-5">
  <h3>About this report</h3>
  <p>
    This report shows all of the billable traffic for your site.
    You can filter it to better understand what is going on with your traffic.
  </p>
  <em>
  This report updates close to real-time.
  </em>
</section>
{% endblock explainer %}

{% block summary %}
  {% include "adserver/includes/publisher-paid-notice.html" with publisher=publisher only %}

  <section>
    <div>
      <div class="row">
        <h2 class="col-md-8">{% trans 'Advertising results' %}</h2>

        {% if export_url %}
          <aside class="mb-3 col-md-4 text-right">
            <a href="{{ export_url }}" class="btn btn-sm btn-outline-secondary" role="button" aria-pressed="true">
              <span class="fa fa-download mr-1" aria-hidden="true"></span>
              <span>CSV Export</span>
            </a>
          </aside>
        {% endif %}
      </div>

      <table class="table table-hover">
        <thead>
          <tr>
            <th><strong>{% trans 'Report Index' %}</strong></th>
            <th class="text-right"><strong>{% trans 'Total&nbsp;Views' %}</strong></th>
            <th class="text-right"><strong>{% trans 'Total&nbsp;Clicks' %}</strong></th>
            <th class="text-right"><strong>{% blocktrans %}Total&nbsp;<abbr title="Click through rate">CTR</abbr>{% endblocktrans %}</strong></th>
            <th class="text-right"><strong>{% trans 'Total&nbsp;Revenue' %}</strong></th>
            <th class="text-right"><strong>{% trans 'Your&nbsp;Revenue&nbsp;Share' %}</strong></th>
            {% if request.user.is_staff %}
            <th class="text-right"><strong>{% trans 'Fill Rate' %}</strong></th>
            <th class="text-right"><strong>{% trans 'View Rate' %}</strong></th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for result in report.results %}
            {% if result.views > 0 or result.clicks > 0 %}
            <tr>
              <td>{{ result.index }}</td>
              <td class="text-right">{{ result.views|intcomma }}</td>
              <td class="text-right">{{ result.clicks|intcomma }}</td>
              <td class="text-right">{{ result.ctr|floatformat:3 }}%</td>
              <td class="text-right">${{ result.revenue|floatformat:2|intcomma }}</td>
              <td class="text-right">${{ result.revenue_share|floatformat:2|intcomma }}</td>
              {% if request.user.is_staff %}
              <td class="text-right">{{ result.fill_rate|floatformat:1 }}%</td>
              <td class="text-right">{{ result.view_rate|floatformat:1 }}%</td>
              {% endif %}
            </tr>
            {% endif %}
          {% endfor %}
          <tr>
            <td><strong>{{ start_date|date:"M j, Y" }} - {{ end_date|date:"M j, Y" }}</strong></td>
            <td class="text-right"><strong>{{ report.total.views|intcomma }}</strong></td>
            <td class="text-right"><strong>{{ report.total.clicks|intcomma }}</strong></td>
            <td class="text-right"><strong>{{ report.total.ctr|floatformat:3 }}%</strong></td>
            <td class="text-right"><strong>${{ report.total.revenue|floatformat:2|intcomma }}</strong></td>
            <td class="text-right"><strong>${{ report.total.revenue_share|floatformat:2|intcomma }}</strong></td>
            {% if request.user.is_staff %}
            <td class="text-right">{{ report.total.fill_rate|floatformat:1 }}%</td>
            <td class="text-right">{{ report.total.view_rate|floatformat:1 }}%</td>
            {% endif %}
          </tr>
        </tbody>
      </table>
    </div>
  </section>
{% endblock summary %}


{% block report %}{% endblock report %}
